---
/**
 * Version Badge Component
 * 
 * Displays the current API version with optional link to changelog.
 * Shows in the header area of documentation pages.
 */
import { getCurrentVersion, hasMultipleVersions, API_VERSIONS } from '../config/versions';

const currentVersion = getCurrentVersion();
const showSelector = hasMultipleVersions();
---

<div class="version-badge-container">
  {showSelector ? (
    <div class="version-selector">
      <select id="version-select" class="version-select">
        {API_VERSIONS.map((version) => (
          <option 
            value={version.id} 
            selected={version.current}
            data-deprecated={version.deprecated || false}
          >
            {version.label}
            {version.deprecated && ' (Deprecated)'}
          </option>
        ))}
      </select>
      <svg class="select-arrow" xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <path d="m6 9 6 6 6-6"/>
      </svg>
    </div>
  ) : (
    <a href={`/changelog${currentVersion.changelogAnchor || ''}`} class="version-badge">
      <span class="version-label">API</span>
      <span class="version-number">{currentVersion.id}</span>
    </a>
  )}
</div>

<style>
  .version-badge-container {
    display: flex;
    align-items: center;
    margin-left: 0.75rem;
  }

  .version-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    border-radius: 9999px;
    background: var(--sl-color-accent-low);
    color: var(--sl-color-accent);
    font-size: 0.75rem;
    font-weight: 600;
    text-decoration: none;
    transition: background 0.15s ease;
  }

  .version-badge:hover {
    background: var(--sl-color-accent);
    color: var(--sl-color-accent-high);
  }

  .version-label {
    opacity: 0.8;
  }

  .version-number {
    font-family: monospace;
  }

  .version-selector {
    position: relative;
    display: inline-flex;
    align-items: center;
  }

  .version-select {
    appearance: none;
    background: var(--sl-color-accent-low);
    border: 1px solid var(--sl-color-accent);
    border-radius: 0.375rem;
    color: var(--sl-color-accent);
    font-size: 0.75rem;
    font-weight: 600;
    padding: 0.25rem 1.5rem 0.25rem 0.5rem;
    cursor: pointer;
    transition: all 0.15s ease;
  }

  .version-select:hover {
    background: var(--sl-color-accent);
    color: var(--sl-color-accent-high);
  }

  .version-select:focus {
    outline: 2px solid var(--sl-color-accent);
    outline-offset: 2px;
  }

  .select-arrow {
    position: absolute;
    right: 0.5rem;
    pointer-events: none;
    color: currentColor;
  }

  /* Deprecated version styling */
  .version-select option[data-deprecated="true"] {
    color: var(--sl-color-orange);
  }
</style>

<script>
  // Handle version selection (for future multi-version support)
  const versionSelect = document.getElementById('version-select') as HTMLSelectElement;
  if (versionSelect) {
    versionSelect.addEventListener('change', (e) => {
      const target = e.target as HTMLSelectElement;
      const selectedVersion = target.value;
      // For now, all content is v1 - in future, redirect to versioned path
      // window.location.href = `/docs/${selectedVersion}/`;
      console.log(`Selected version: ${selectedVersion}`);
    });
  }
</script>
